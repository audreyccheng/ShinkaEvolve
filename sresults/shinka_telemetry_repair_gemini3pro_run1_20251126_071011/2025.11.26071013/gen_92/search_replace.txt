<NAME>
consensus_refinement
</NAME>

<DESCRIPTION>
1. Refines `resolve_direction` to use intelligent consensus for flow hints. Instead of averaging conflicting hints (which might create a phantom target), it selects the hint that best corroborates the raw measurements (local or peer). This handles cases where one router generates a bad hint due to other corrupted interfaces.
2. Updates `calibrate` to assign higher confidence to heuristic repairs ("Trust Non-Zero") when the traffic volume is significant (high SNR), reflecting that false positives are less likely for high-bandwidth readings.
</DESCRIPTION>

<DIFF>
<<<<<<< SEARCH
                # Consensus Target from Hints
                target = None
                if hints:
                    target = sum(hints) / len(hints)

                # Decision Logic
=======
                # Consensus Target from Hints
                target = None
                if hints:
                    # Consensus Logic: Outlier Rejection
                    # If hints diverge, prefer the one supported by raw measurements
                    if len(hints) > 1 and abs(hints[0] - hints[1]) > (max(hints) * 0.2 + 1.0):
                        h1, h2 = hints[0], hints[1]
                        # Support scores (lower error is better)
                        s1 = min(abs(h1 - local_val), abs(h1 - peer_val))
                        s2 = min(abs(h2 - local_val), abs(h2 - peer_val))

                        if s1 < s2 - 0.05: target = h1
                        elif s2 < s1 - 0.05: target = h2
                        else: target = sum(hints) / len(hints)
                    else:
                        target = sum(hints) / len(hints)

                # Decision Logic
>>>>>>> REPLACE
<<<<<<< SEARCH
            # Case D: No Verification (Broken Symmetry, No Flow Hint)
            if err_flow is None:
                # Heuristic guess.
                return 0.50

            # Case E: Conflict (Broken Symmetry, Broken Flow)
=======
            # Case D: No Verification (Broken Symmetry, No Flow Hint)
            if err_flow is None:
                # Heuristic guess.
                # SNR Adjustment: High values are less likely to be noise.
                if val > 50.0: return 0.80
                if val > 10.0: return 0.70
                return 0.50

            # Case E: Conflict (Broken Symmetry, Broken Flow)
>>>>>>> REPLACE
</DIFF>